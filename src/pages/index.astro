---
// 1. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import Layout from '../layouts/Layout.astro';
// 2. ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— (Layout.astro ã‹ã‚‰ç§»å‹•)
import { getCollection } from 'astro:content';

const allItems = await getCollection('items');
const boughtItems = allItems
  .filter(item => item.data.status === 'bought')
  .sort((a, b) => (a.data.purchase_date && b.data.purchase_date) ? b.data.purchase_date.getTime() - a.data.purchase_date.getTime() : 0);
const wantItems = allItems
  .filter(item => item.data.status === 'want')
  .sort((a, b) => (a.data.priority || 99) - (b.data.priority || 99));

const totalSpent = boughtItems.reduce((sum, item) => sum + item.data.price, 0);
---
<Layout>
  <h2>ğŸ“ˆ ã‚µãƒãƒªãƒ¼</h2>
  <p><strong>æ”¯å‡ºç·é¡:</strong> {totalSpent.toLocaleString()} å††</p>

  <h2>â­ æ¬²ã—ã„ã‚‚ã®ãƒªã‚¹ãƒˆ (Want)</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Price</th><th>Category</th><th>Priority</th></tr>
    </thead>
    <tbody class="want">
      {wantItems.map(item => (
        <tr>
          <td>
            <a href={item.slug}>{item.data.name}</a>
          </td>
          <td>{item.data.price.toLocaleString()} å††</td>
          <td>{item.data.category}</td>
          <td>{item.data.priority}</td>
        </tr>
      ))}
    </tbody>
  </table>

  <h2>ğŸ›’ è³¼å…¥æ¸ˆã¿ãƒªã‚¹ãƒˆ (Bought)</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Price</th><th>Category</th><th>Purchase Date</th></tr>
    </thead>
    <tbody class"bought">
      {boughtItems.map(item => (
        <tr>
          <td>
            <a href={item.slug}>{item.data.name}</a>
          </td>
          <td>{item.data.price.toLocaleString()} å††</td>
          <td>{item.data.category}</td>
          <td>{item.data.purchase_date?.toLocaleDateString('ja-JP')}</td>
        </tr>
      ))}
    </tbody>
  </table>
</Layout>
