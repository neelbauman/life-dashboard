---
// --- 1. ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨é›†è¨ˆ ---
import { getCollection } from 'astro:content';

// AstroãŒ 'items' ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å…¨MDã‚’ãƒ‘ãƒ¼ã‚¹ãƒ»æ¤œè¨¼ã—ã¦ãã‚Œã¾ã™
const allItems = await getCollection('items');

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§åˆ†é¡
const boughtItems = allItems
  .filter(item => item.data.status === 'bought')
  .sort((a, b) => b.data.purchase_date.getTime() - a.data.purchase_date.getTime()); // è³¼å…¥æ—¥ã§ã‚½ãƒ¼ãƒˆ

const wantItems = allItems
  .filter(item => item.data.status === 'want')
  .sort((a, b) => (a.data.priority || 99) - (b.data.priority || 99)); // å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆ

// --- 2. ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®— ---
const totalSpent = boughtItems.reduce((sum, item) => sum + item.data.price, 0);

// (ç©ç«‹ãƒ­ã‚¸ãƒƒã‚¯ã¯ data/config.yml ã‚’èª­ã¿è¾¼ã‚€ã‹ã€
//  Astroã®ç’°å¢ƒå¤‰æ•°ãªã©ã§ç®¡ç†ã§ãã¾ã™)
---
<!doctype html>
<html lang="ja">
<head>
  <title>My Want List Dashboard</title>
  <style>
    body { font-family: sans-serif; max-width: 900px; margin: 20px auto; }
    h1, h2 { border-bottom: 2px solid #eee; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .want td:nth-child(2) { font-weight: bold; }
    .bought { background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>ğŸ“Š Want List Dashboard</h1>

  <h2>ğŸ“ˆ ã‚µãƒãƒªãƒ¼</h2>
  <p><strong>æ”¯å‡ºç·é¡:</strong> {totalSpent.toLocaleString()} å††</p>
  <h2>â­ æ¬²ã—ã„ã‚‚ã®ãƒªã‚¹ãƒˆ (Want)</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Price</th><th>Category</th><th>Priority</th></tr>
    </thead>
    <tbody class="want">
      {wantItems.map(item => (
        <tr>
          <td>
            <a href={`${item.slug}`}>{item.data.name}</a>
          </td>
          <td>{item.data.price.toLocaleString()} å††</td>
          <td>{item.data.category}</td>
          <td>{item.data.priority}</td>
        </tr>
      ))}
    </tbody>
  </table>

  <h2>ğŸ›’ è³¼å…¥æ¸ˆã¿ãƒªã‚¹ãƒˆ (Bought)</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Price</th><th>Category</th><th>Purchase Date</th></tr>
    </thead>
    <tbody class="bought">
      {boughtItems.map(item => (
        <tr>
          <td>
            <a href={`${item.slug}`}>{item.data.name}</a>
          </td>
          <td>{item.data.price.toLocaleString()} å††</td>
          <td>{item.data.category}</td>
          <td>{item.data.purchase_date.toLocaleDateString('ja-JP')}</td>
        </tr>
      ))}
    </tbody>
  </table>

</body>
</html>
